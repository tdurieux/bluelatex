'use strict';angular.module('bluelatex.Shared.Controllers.Main',['bluelatex.User.Services.User','bluelatex.User.Services.Session','bluelatex.Shared.Services.WindowActive','ngStorage','bluelatex.Paper.Services.Ace']).controller('MainController',['$rootScope','$scope','UserService','SessionService','$route','$location','$routeParams','AceService','$sessionStorage','$log',function(c,d,e,f,g,h,i,j,k,l){d.$route=g;d.$location=h;d.$routeParams=i;d.ace=j;d.$on('handleTopAction',function(a,b){d.$broadcast('handleAction',b)});d.$on("$routeChangeSuccess",function(a,b){d.currentRoute=b});var m=function(){if(k.username&&k.password){f.login(k.username,k.password).then(function(){e.getInfo({username:k.username}).then(function(a){c.loggedUser={name:k.username,first_name:a.first_name,last_name:a.last_name,email:a.email,etag:a.header.etag}},function(a){c.loggedUser={}})})}};var n=60*1000;var o=setInterval(m,n);m();d.$on('windowActive',function(a,b){if(b==false){clearInterval(o);o=null}else if(o==null){o=setInterval(m,n);m()}})}]);