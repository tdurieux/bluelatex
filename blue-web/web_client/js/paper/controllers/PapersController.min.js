angular.module('bluelatex.Paper.Controllers.Papers',['bluelatex.Paper.Services.Paper']).controller('PapersController',['$rootScope','$scope','PaperService','$log','MessagesService',function(c,d,e,f,g){d.reverse=false;d.predicate='title';e.getUserPapers(c.loggedUser).then(function(a){d.papers=[];for(var i=0;i<a.length;i++){a[i].date=new Date();a[i].tags=d.tags;d.papers.push(a[i])}},function(a){g.clear();switch(a.status){case 401:g.error('_List_Papers_User_must_be_authentified_',a);break;case 500:g.error('_List_Papers_Something_wrong_happened_',a);break;default:g.error('_List_Papers_Something_wrong_happened_',a)}});d.papers=[];d.tags=[{label:'Brouillion',color:get_radom_color()},{label:'A tag',color:get_radom_color()},{label:'CV',color:get_radom_color()}];d.display_style='list';d.date_filter='all';d.role_filter='all';d.tag_filter='all';var h=function(a){var b=new Date();return a.date.getDate()==b.getDate()&&a.date.getMonth()==b.getMonth()&&a.date.getFullYear()==b.getFullYear()};d.dateFilterToday=h;var j=function(a){var b=new Date();b.setDate(b.getDate()-1);return a.date.getDate()==b.getDate()&&a.date.getMonth()==b.getMonth()&&a.date.getFullYear()==b.getFullYear()};d.dateFilterYesterday=j;var k=function(a){var b=new Date();return a.date.getWeek()==b.getWeek()-1};d.dateFilterLWeek=k;var l=function(a){var b=new Date();return a.date.getWeek()==b.getWeek()&&a.date.getFullYear()==b.getFullYear()};d.dateFilterTWeek=l;var m=function(a){var b=new Date();return a.date.getMonth()==b.getMonth()&&a.date.getFullYear()==b.getFullYear()};d.dateFilterMonth=m;var n=function(a){var b=new Date();return a.date.getFullYear()==b.getFullYear()};d.dateFilterYear=n;d.dateFilter=function(a){switch(d.date_filter){case'all':return true;case'today':return h(a);case'yesterday':return j(a);case'lweek':return k(a);case'tweek':return l(a);case'month':return m(a);case'year':return n(a)}};var o=function(a){return a.role=='author'};d.roleFilterAuthor=o;var p=function(a){return a.role=='reviewer'};d.roleFilterReviewer=p;d.roleFilter=function(a){switch(d.role_filter){case'all':return true;case'author':return o(a);case'reviewer':return p(a)}};d.delete=function(b){e.delete(b.id).then(function(a){if(a.response==true){d.papers.splice(d.papers.indexOf(b),1)}},function(a){g.clear();switch(a.status){case 401:g.error('_Delete_paper_User_must_be_authentified_',a);c.loggedUser={};break;case 403:g.error('_Delete_paper_Authenticated_user_has_no_sufficient_rights_to_delete_the_paper_',a);break;case 500:g.error('_Delete_paper_Something_wrong_happened_',a);break;default:g.error('_Delete_paper_Something_wrong_happened_',a)}})};d.$on('handleAction',function(a,b){if(d[b]){d[b]()}})}]);