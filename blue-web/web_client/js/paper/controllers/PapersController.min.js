angular.module('bluelatex.Paper.Controllers.Papers',['bluelatex.Paper.Services.Paper','bluelatex.User.Services.User']).controller('PapersController',['$rootScope','$scope','localize','UserService','PaperService','$log',function(c,d,e,f,g,h){d.reverse=false;d.predicate='title';f.getPapers(c.loggedUser).then(function(a){d.papers=[];for(var i=0;i<a.length;i++){a[i].date=new Date();a[i].tags=d.tags;d.papers.push(a[i])}},function(a){d.errors=[];switch(a.status){case 401:d.errors.push(e.getLocalizedString('_List_Papers_User_must_be_authentified_'));break;case 500:d.errors.push(e.getLocalizedString('_List_Papers_Something_wrong_happened_'));break;default:d.errors.push(e.getLocalizedString('_List_Papers_Something_wrong_happened_'));h.error(a)}});d.papers=[];d.tags=[{label:'Brouillion',color:get_radom_color()},{label:'A tag',color:get_radom_color()},{label:'CV',color:get_radom_color()}];d.display_style='list';d.date_filter='all';d.role_filter='all';d.tag_filter='all';var j=function(a){var b=new Date();return a.date.getDate()==b.getDate()&&a.date.getMonth()==b.getMonth()&&a.date.getFullYear()==b.getFullYear()};d.dateFilterToday=j;var k=function(a){var b=new Date();b.setDate(b.getDate()-1);return a.date.getDate()==b.getDate()&&a.date.getMonth()==b.getMonth()&&a.date.getFullYear()==b.getFullYear()};d.dateFilterYesterday=k;var l=function(a){var b=new Date();return a.date.getWeek()==b.getWeek()-1};d.dateFilterLWeek=l;var m=function(a){var b=new Date();return a.date.getWeek()==b.getWeek()&&a.date.getFullYear()==b.getFullYear()};d.dateFilterTWeek=m;var n=function(a){var b=new Date();return a.date.getMonth()==b.getMonth()&&a.date.getFullYear()==b.getFullYear()};d.dateFilterMonth=n;var o=function(a){var b=new Date();return a.date.getFullYear()==b.getFullYear()};d.dateFilterYear=o;d.dateFilter=function(a){switch(d.date_filter){case'all':return true;case'today':return j(a);case'yesterday':return k(a);case'lweek':return l(a);case'tweek':return m(a);case'month':return n(a);case'year':return o(a)}};var p=function(a){return a.role=='author'};d.roleFilterAuthor=p;var q=function(a){return a.role=='reviewer'};d.roleFilterReviewer=q;d.roleFilter=function(a){switch(d.role_filter){case'all':return true;case'author':return p(a);case'reviewer':return q(a)}};d.delete=function(b){g.delete(b.id).then(function(a){if(a.response==true){d.papers.splice(d.papers.indexOf(b),1)}},function(a){d.errors=[];switch(a.status){case 401:d.errors.push(e.getLocalizedString('_Delete_paper_User_must_be_authentified_'));c.loggedUser={};break;case 403:d.errors.push(e.getLocalizedString('_Delete_paper_Authenticated_user_has_no_sufficient_rights_to_delete_the_paper_'));break;case 500:d.errors.push(e.getLocalizedString('_Delete_paper_Something_wrong_happened_'));break;default:d.errors.push(e.getLocalizedString('_Delete_paper_Something_wrong_happened_'));h.error(a)}})};d.$on('handleAction',function(a,b){if(d[b]){d[b]()}})}]);