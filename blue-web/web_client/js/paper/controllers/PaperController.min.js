angular.module('bluelatex.Paper.Controllers.Paper',['angularFileUpload','bluelatex.Paper.Directives.Toc','bluelatex.Paper.Services.Ace','bluelatex.Paper.Services.Paper','bluelatex.Paper.Services.Ace','bluelatex.Latex.Services.SyncTexParser']).controller('PaperController',['$scope','localize','$location','AceService','PaperService','$routeParams','$upload','$log','MessagesService','SyncTexParserService',function(h,k,l,m,n,o,p,q,r,s){h.pageViewport={};h.currentElem={};h.resources=[];h.paper={};h.listType='debug';h.mode='ace';h.logs=[];h.toc=[];h.content='';h.new_file={};h.synctex=null;h.current={line:0};h.vignetteType="pdf";h.urlPaper="/ressources/latex_example";h.scale="auto";h.currentPage=1;h.totalPage=1;var t=o.id;var u=function(){n.getInfo(t).then(function(a){h.paper=a;h.paper.etag=a.header.etag},function(a){r.clear();switch(err.status){case 400:r.error('_Delete_resource_Some_parameters_are_missing_',err);break;case 401:r.error('_Delete_resource_Wrong_username_and_or_password_',err);break;case 500:r.error('_Delete_resource_Something_wrong_happened_',err);break;default:r.error('_Delete_resource_Something_wrong_happened_',err)}})};u();var v=function(){n.getSynchronized(t).then(function(a){h.synchronizedFiles=a},function(a){r.clear();switch(err.status){case 400:r.error('_Delete_resource_Some_parameters_are_missing_',err);break;case 401:r.error('_Delete_resource_Wrong_username_and_or_password_',err);break;case 500:r.error('_Delete_resource_Something_wrong_happened_',err);break;default:r.error('_Delete_resource_Something_wrong_happened_',err)}})};v();var w=function(){n.getResources(t).then(function(a){h.resources=a},function(a){r.clear();switch(err.status){case 400:r.error('_Delete_resource_Some_parameters_are_missing_',err);break;case 401:r.error('_Delete_resource_Wrong_username_and_or_password_',err);break;case 500:r.error('_Delete_resource_Something_wrong_happened_',err);break;default:r.error('_Delete_resource_Something_wrong_happened_',err)}})};w();var x=function(b){n.getTexfile(b).then(function(a){h.content=a},function(a){})};x('ressources/latex_example.tex');var y=function(b,a){var c=preview.getElementsByClassName('preview_page_container');var d=document.createElement('div');d.style.bottom=b.bottom+'px';d.style.left=b.left+'px';d.style.width=b.width+'px';d.style.height=b.height+'px';d.classList.add(b.type);d.classList.add('debug_block');var e=document.createElement('div');e.classList.add('info');e.innerHTML='<span class="file">'+b.fileNumber+'</span><span class="line">'+b.line+'</span>';d.appendChild(e);c[a-1].appendChild(d)};var z=function(a,b){var c=preview.getElementsByClassName('preview_page_container');var d=document.createElement('div');d.style.bottom=a.bottom+'px';d.style.left=a.left+'px';d.style.width='1px';d.style.height=a.height+'px';d.classList.add('debug_block');d.classList.add(a.type);var e=document.createElement('div');e.classList.add('info');e.innerHTML='<span class="file">'+a.fileNumber+'</span><span class="line">'+a.line+'</span>';d.appendChild(e);c[b-1].appendChild(d)};var A=function(){var a=preview.getElementsByClassName('debug_block');for(var i=a.length-1;i>=0;i--){var b=a[i];b.parentNode.removeChild(b)}};var B=function(a,b){if(!isArray(a))return;for(var j=a.length-1;j>=0;j--){var c=a[j];y(c,b);B(c.blocks,b);for(var i=c.elements.length-1;i>=0;i--){var d=c.elements[i]z(d,b)}}};var C=function(a){A();for(i in a){var b=a[i];B(b.blocks,i)}};s.parseUrl('ressources/latex_example.synctex').then(function(a){h.synctex=a});h.$watch('pageViewport',function(a){if(a.scale==null)return});h.$watch('displaySyncTexBox',function(a){if(a)C(h.synctex.pages);else A()});h.$on('handleAction',function(a,b){if(h[b]){h[b]()}});h.switch_editor_mode=function(){h.mode=(h.mode=='ace'?'text':'ace');if(h.mode=='ace'){m.setContent(h.content);m.getEditor().focus()}};h.compile=function(){};h.nextPage=function(){if(h.currentPage!=h.totalPage){h.currentPage++}};h.prevPage=function(){if(h.currentPage!=1){h.currentPage--}};h.goToLine=function(a){m.goToLine(a);h.current.line=a};var D=function(){var a=preview.getElementsByClassName('hightlight_line');for(var i=a.length-1;i>=0;i--){var b=a[i];b.parentNode.removeChild(b)}};var E=function(a,b,c,d,e){var f=preview.getElementsByClassName('preview_page_container');if(!f[e-1])return;var g=document.createElement('div');g.style.bottom=b+'px';g.style.left=a+'px';g.style.width=c+'px';g.style.height=d+'px';g.classList.add('hightlight_line');f[e-1].appendChild(g)};h.aceLoaded=function(a){m.aceLoaded(a,function(){h.toc=m.getToc();m.getSession().on("change",function(){h.toc=m.getToc()});a.selection.on("changeCursor",function(){h.$apply(function(){h.current.line=a.selection.getCursor().row+1})});a.focus()})};h.aceChanged=function(e){};h.onFileSelect=function(a){if(a.length>0){var b=a[0];h.new_file={title:b.name,name:b.name.replace(/\.[^\.]+$/,''),type:getFileType(b.name),file:b,extension:getFileNameExtension(b.name)}}};h.uploadResource=function(){n.uploadResource(t,h.new_file.title,h.new_file.file).then(function(a){if(a.response==true){w();h.new_file={}}else r.error('_Upload_resource_Some_parameters_are_missing_')},function(a){r.clear();switch(a.status){case 400:r.error('_Upload_resource_Some_parameters_are_missing_',a);break;case 401:r.error('_Upload_resource_Wrong_username_and_or_password_',a);break;case 500:r.error('_Upload_resource_Something_wrong_happened_',a);break;default:r.error('_Upload_resource_Something_wrong_happened_',a)}},function(a){q.debug(a)})};h.cancelUploadResource=function(){h.new_file={}};h.viewResource=function(a){};h.removeResource=function(b){n.removeResource(t,b.title).then(function(a){if(a.response==true){w();h.new_file={}}else r.error('_Delete_resource_Some_parameters_are_missing_')},function(a){r.clear();switch(a.status){case 400:r.error('_Delete_resource_Some_parameters_are_missing_',a);break;case 401:r.error('_Delete_resource_Wrong_username_and_or_password_',a);break;case 500:r.error('_Delete_resource_Something_wrong_happened_',a);break;default:r.error('_Delete_resource_Something_wrong_happened_',a)}})};h.downloadResource=function(a){window.open(n.getResourceUrl(t,a.title))}}]);