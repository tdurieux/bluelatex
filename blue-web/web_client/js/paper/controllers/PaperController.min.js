angular.module('bluelatex.Paper.Controllers.Paper',['angularFileUpload','bluelatex.Paper.Directives.Toc','bluelatex.Paper.Services.Ace','bluelatex.Paper.Services.Paper','bluelatex.Paper.Services.Ace']).controller('PaperController',['$scope','localize','$location','AceService','PaperService','$routeParams','$upload','$log','MessagesService',function(c,d,f,g,h,i,j,k,l){var m=i.id;var n=function(){h.getInfo(m).then(function(a){c.paper=a;c.paper.etag=a.header.etag},function(a){l.clear();switch(err.status){case 400:l.error('_Delete_resource_Some_parameters_are_missing_',err);break;case 401:l.error('_Delete_resource_Wrong_username_and_or_password_',err);break;case 500:l.error('_Delete_resource_Something_wrong_happened_',err);break;default:l.error('_Delete_resource_Something_wrong_happened_',err)}})};n();var o=function(){h.getSynchronized(m).then(function(a){c.synchronizedFiles=a},function(a){l.clear();switch(err.status){case 400:l.error('_Delete_resource_Some_parameters_are_missing_',err);break;case 401:l.error('_Delete_resource_Wrong_username_and_or_password_',err);break;case 500:l.error('_Delete_resource_Something_wrong_happened_',err);break;default:l.error('_Delete_resource_Something_wrong_happened_',err)}})};o();var p=function(){h.getResources(m).then(function(a){c.resources=a},function(a){l.clear();switch(err.status){case 400:l.error('_Delete_resource_Some_parameters_are_missing_',err);break;case 401:l.error('_Delete_resource_Wrong_username_and_or_password_',err);break;case 500:l.error('_Delete_resource_Something_wrong_happened_',err);break;default:l.error('_Delete_resource_Something_wrong_happened_',err)}})};p();c.resources=[];c.paper={};c.listType='files';c.mode='ace';c.logs=[];c.toc=[];c.content='';c.$on('handleAction',function(a,b){if(c[b]){c[b]()}});c.switch_editor_mode=function(){c.mode=(c.mode=='ace'?'text':'ace');if(c.mode=='ace'){g.setContent(c.content);g.getEditor().focus()}};c.compile=function(){};c.goToLine=function(a){g.goToLine(a)};c.aceLoaded=function(a){g.aceLoaded(a,function(){c.toc=g.getToc();g.getSession().on("change",function(){c.toc=g.getToc()});a.focus()})};c.aceChanged=function(e){};c.new_file={};c.onFileSelect=function(a){if(a.length>0){var b=a[0];c.new_file={title:b.name,name:b.name.replace(/\.[^\.]+$/,''),type:getFileType(b.name),file:b,extension:getFileNameExtension(b.name)}}};c.uploadResource=function(){h.uploadResource(m,c.new_file.title,c.new_file.file).then(function(a){p();c.new_file={}},function(a){l.clear();switch(a.status){case 400:l.error('_Upload_resource_Some_parameters_are_missing_',a);break;case 401:l.error('_Upload_resource_Wrong_username_and_or_password_',a);break;case 500:l.error('_Upload_resource_Something_wrong_happened_',a);break;default:l.error('_Upload_resource_Something_wrong_happened_',a)}},function(a){k.debug(a)})};c.cancelUploadResource=function(){c.new_file={}};c.viewResource=function(a){};c.removeResource=function(b){h.removeResource(m,b.title).then(function(a){p()},function(a){l.clear();switch(a.status){case 400:l.error('_Delete_resource_Some_parameters_are_missing_',a);break;case 401:l.error('_Delete_resource_Wrong_username_and_or_password_',a);break;case 500:l.error('_Delete_resource_Something_wrong_happened_',a);break;default:l.error('_Delete_resource_Something_wrong_happened_',a)}})};c.downloadResource=function(a){window.open(h.getResourceUrl(m,a.title))}}]);