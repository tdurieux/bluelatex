angular.module('bluelatex.Paper.Controllers.Paper',['angularFileUpload','bluelatex.Paper.Directives.Toc','bluelatex.Paper.Services.Ace','bluelatex.Paper.Services.Paper','bluelatex.Paper.Services.Ace']).controller('PaperController',['$scope','localize','$location','AceService','PaperService','$routeParams','$upload','$log',function(c,d,f,g,h,i,j,k){var l=i.id;var m=function(){h.getInfo(l).then(function(a){c.paper=a;c.paper.etag=a.header.etag},function(a){k.error(a)})};m();var n=function(){h.getSynchronized(l).then(function(a){c.synchronizedFiles=a},function(a){k.error(a)})};n();var o=function(){h.getResources(l).then(function(a){c.resources=a},function(a){k.error(a)})};o();c.resources=[];c.paper={};c.listType='files';c.mode='ace';c.logs=[];c.toc=[];c.content='';c.$on('handleAction',function(a,b){if(c[b]){c[b]()}});c.switch_editor_mode=function(){c.mode=(c.mode=='ace'?'text':'ace');if(c.mode=='ace'){g.setContent(c.content);g.getEditor().focus()}};c.compile=function(){};c.goToLine=function(a){g.goToLine(a)};c.aceLoaded=function(a){g.aceLoaded(a,function(){c.toc=g.getToc();g.getSession().on("change",function(){c.toc=g.getToc()});a.focus()})};c.aceChanged=function(e){};c.new_file={};c.onFileSelect=function(a){if(a.length>0){var b=a[0];c.new_file={title:b.name,name:b.name.replace(/\.[^\.]+$/,''),type:getFileType(b.name),file:b,extension:getFileNameExtension(b.name)}}};c.uploadResource=function(){h.uploadResource(l,c.new_file.title,c.new_file.file).then(function(a){o();c.new_file={}},function(a){switch(err.status){case 400:c.errors.push(d.getLocalizedString('_Upload_resource_Some_parameters_are_missing_'));break;case 401:c.errors.push(d.getLocalizedString('_Upload_resource_Wrong_username_and_or_password_'));break;case 500:c.errors.push(d.getLocalizedString('_Upload_resource_Something_wrong_happened_'));break;default:c.errors.push(d.getLocalizedString('_Upload_resource_Something_wrong_happened_'));k.error(err)}},function(a){k.log(a)})};c.cancelUploadResource=function(){c.new_file={}};c.viewResource=function(a){};c.removeResource=function(b){h.removeResource(l,b.title).then(function(a){o()},function(a){c.errors=[];switch(err.status){case 400:c.errors.push(d.getLocalizedString('_Delete_resource_Some_parameters_are_missing_'));break;case 401:c.errors.push(d.getLocalizedString('_Delete_resource_Wrong_username_and_or_password_'));break;case 500:c.errors.push(d.getLocalizedString('_Delete_resource_Something_wrong_happened_'));break;default:c.errors.push(d.getLocalizedString('_Delete_resource_Something_wrong_happened_'));k.log(err)}})};c.downloadResource=function(a){window.open(Paper.getResourceUrl(l,a.title))}}]);