angular.module('bluelatex.Paper.Directives.Toc',[]).directive('blToc',['$compile','$document',function(o,p){var q=function(b,c,d){if(c==null)return;var e=null;var f=null;var g=-1;var h;var k=0;b.text('');for(var i=0;i<c.length;i++){var m=c[i];if(f==null){var l=p[0].createElement(m.level<3?'ol':'ul');f=l;e=f}else if(m.restart==true){var j=g;for(;j>=m.level;j--){f=f.parentElement}var l=p[0].createElement('ul');f.appendChild(l);f=l}else if(g<m.level){var j=m.level;for(;j>g;j--){var t=p[0].createElement(j<3?'ol':'ul');f.appendChild(t);f=t}}else if(g>m.level){var j=g;for(;j>m.level;j--){f=f.parentElement}}g=m.level;var n=p[0].createElement('li');var a=p[0].createElement('a');a.setAttribute('ng-click','goToLine('+m.line+')');a.innerHTML=m.title;n.appendChild(a);f.appendChild(n);if(!h)h=n;if(k<=d.current.line&&m.line>d.current.line){h.setAttribute('class','current')}else if(i==c.length-1&&m.line<=d.current.line){n.setAttribute('class','current')}k=m.line;h=n}if(c.length==0){b.html("No table of contents")}else{angular.element(b).append(o(e)(d))}};return function(b,c,d){b.$watch('toc',function(a){q(c,a,b)});b.$watch('current.line',function(a){console.log(a);q(c,b.toc,b)});q(c,b.toc,b)}}]);