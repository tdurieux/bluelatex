angular.module("bluelatex.User.Services.User",["ngResource",'jmdobry.angular-cache','bluelatex.Shared.Services.Configuration']).factory("UserService",['$resource','$http','$log','$angularCacheFactory','$q','apiRootUrl',function(e,f,g,h,j,k){var l=h('userCache',{maxAge:300000,storageMode:'localStorage',deleteOnExpire:'aggressive',verifyIntegrity:true});var m=e(k+"/users/:username/reset",{username:"@username"},{"getToken":{method:"get"},"reset":{'method':'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'}}});var n=e(k+"/users",{},{"get":{method:"get",format:'json',isArray:true,transformResponse:[function(a,b){var c=[];a=JSON.parse(a);for(var i=0;i<a.length;i++){var d=a[i];c.push({name:d})};return c}].concat(f.defaults.transformResponse)}});var o=e(k+"/users/:username/info",{username:"@username"},{"get":{method:"get",format:'json',transformResponse:[function(a,b){a=JSON.parse(a);a.header=b();return a}].concat(f.defaults.transformResponse)},"modify":{'method':'PATCH',transformRequest:[function(a,b){g.log(a,b);return a}].concat(f.defaults.transformRequest)}});var p=e(k+"/users",null,{"register":{method:"POST",headers:{'Content-Type':'application/x-www-form-urlencoded'}}});var q=e(k+"/users/:username",{username:"@username"},{"remove":{'method':'DELETE'}});return{getPasswordToken:function(a){return m.getToken({username:a}).$promise},resetPassword:function(a,b,c,d){return m.reset({username:a},jsonToPostParameters({reset_token:b,new_password1:c,new_password2:d})).$promise},getInfo:function(b){var c=j.defer();var d=c.promise;if(l.get('/users/'+b.username))c.resolve(l.get('/users/'+b.username));else{o.get({username:b.username}).$promise.then(function(a){l.put('/users/'+b.username,a);c.resolve(a)},function(a){g.error(a);c.reject(a)},function(a){c.notify(a)})}return d},getUsers:function(b){var c=j.defer();var d=c.promise;if(l.get('/users'))c.resolve(l.get('/users'));else{n.get({},{name:b}).$promise.then(function(a){if(b==null)l.put('/users',a);c.resolve(a)},function(a){g.error(a);c.reject(a)},function(a){c.notify(a)})}return d},save:function(b){var c=j.defer();var d=c.promise;o.modify({username:b.name},b).$promise.then(function(a){l.remove('/users/'+b.name);c.resolve(a)},function(a){g.error(a);c.reject(a)},function(a){c.notify(a)});return d},register:function(a){return p.register({},jsonToPostParameters(a)).$promise},remove:function(b){var c=j.defer();var d=c.promise;q.remove({username:b.username},b).$promise.then(function(a){l.remove('/users/'+b.username);c.resolve(a)},function(a){g.error(a);c.reject(a)},function(a){c.notify(a)});return d},clearCache:function(){h.clearAll()}}}]);