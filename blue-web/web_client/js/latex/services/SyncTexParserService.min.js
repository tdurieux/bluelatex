angular.module("bluelatex.Latex.Services.SyncTexParser",[]).factory("SyncTexParserService",['$log','$q','$http',function(q,r,s){var t=65781.76;var u=function(b){var c=r.defer();s({method:'GET',url:b}).then(function(a){c.resolve(v(a.data))},function(a){q.error(a);c.reject(a)});return c.promise};var v=function(a){var b={};var c={};var d={};var e={};var f=[];var g={};var h={};var j={};var k=a.split("\n");j.version=k[0].replace('SyncTeX Version:','');for(var i=1;i<k.length;i++){var l=k[i];match=l.match(/Input:([0-9]+):(.+)/);if(match){g[match[1]]=match[2];continue}match=l.match(/X Offset:([0-9]+)/);if(match){j.offsetX=match[1];continue}match=l.match(/Y Offset:([0-9]+)/);if(match){j.offsetY=match[1];continue}match=l.match(/\{([0-9]+)/);if(match){b={page:match[1],blocks:[],type:'page',};c=b;continue}match=l.match(/\}([0-9]+)/);if(match){h[match[1]]=b;b=null;continue}match=l.match(/\[([0-9]+),([0-9]+):([0-9]+),([0-9]+):([0-9]+),([0-9]+),([0-9]+)/);if(match){var m=[match[3]/t,match[4]/t];var n=[match[5]/t,match[6]/t];var o={type:'vertical',parent:c,fileNumber:parseInt(match[1]),file:g[match[1]],line:parseInt(match[2]),left:m[0],bottom:m[1],width:n[0],height:n[1],depth:parseInt(match[7]),blocks:[],elements:[],page:b.page};c=o;continue}match=l.match(/\]/);if(match){c.parent.blocks.push(c);c=c.parent;continue}match=l.match(/\(([0-9]+),([0-9]+):([0-9]+),([0-9]+):([0-9]+),([0-9]+),([0-9]+)/);if(match){var m=[match[3]/t,match[4]/t];var n=[match[5]/t,match[6]/t];var o={type:'horizontal',parent:c,fileNumber:parseInt(match[1]),file:g[match[1]],line:parseInt(match[2]),left:m[0],bottom:m[1],width:n[0],height:n[1],blocks:[],elements:[],page:b.page};f.push(o);c=o;continue}match=l.match(/\)/);if(match){c.parent.blocks.push(c);c=c.parent;continue}match=l.match(/(.)([0-9]+),([0-9]+):([0-9]+),([0-9]+)(:?([0-9]+))?/);if(match){if(match[1]!='x')continue;var m=[match[4]/t,match[5]/t];if(match[7])var n=[match[7]/t,0];var p={type:match[1],parent:c,fileNumber:parseInt(match[2]),file:g[match[2]],line:parseInt(match[3]),left:m[0],bottom:m[1],height:c.height,to:((n)?n[1]:null),page:b.page};if(e[p.line]==null){e[p.line]=[]}e[p.line].push(p);c.elements.push(p);continue}}j.files=g;j.pages=h;j.blockNumberLine=e;j.hBlocks=f;return j};return{parse:v,parseUrl:u}}]);