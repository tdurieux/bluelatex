angular.module("bluelatex.Latex.Services.SyncTexParser",[]).factory("SyncTexParserService",['$log','$q','$http',function(r,s,t){var u=65781.76;var v=function(b){var c=s.defer();t({method:'GET',url:b}).then(function(a){c.resolve(w(a.data))},function(a){r.error(a);c.reject(a)});return c.promise};var w=function(a){var b=0;var c={};var d={};var e={};var f={};var g=[];var h={};var j={};var k={};var l=a.split("\n");k.version=l[0].replace('SyncTeX Version:','');for(var i=1;i<l.length;i++){var m=l[i];match=m.match(/Input:([0-9]+):(.+)/);if(match){h[match[1]]=match[2];continue}match=m.match(/X Offset:([0-9]+)/);if(match){k.offsetX=match[1];continue}match=m.match(/Y Offset:([0-9]+)/);if(match){k.offsetY=match[1];continue}match=m.match(/\{([0-9]+)/);if(match){c={page:match[1],blocks:[],type:'page',};if(c.page>b){b=c.page}d=c;continue}match=m.match(/\}([0-9]+)/);if(match){j[match[1]]=c;c=null;continue}match=m.match(/\[([0-9]+),([0-9]+):([0-9]+),([0-9]+):([0-9]+),([0-9]+),([0-9]+)/);if(match){var n=[match[3]/u,match[4]/u];var o=[match[5]/u,match[6]/u];var p={type:'vertical',parent:d,fileNumber:parseInt(match[1]),file:h[match[1]],line:parseInt(match[2]),left:n[0],bottom:n[1],width:o[0],height:o[1],depth:parseInt(match[7]),blocks:[],elements:[],page:c.page};d=p;continue}match=m.match(/\]/);if(match){d.parent.blocks.push(d);d=d.parent;continue}match=m.match(/\(([0-9]+),([0-9]+):([0-9]+),([0-9]+):([0-9]+),([0-9]+),([0-9]+)/);if(match){var n=[match[3]/u,match[4]/u];var o=[match[5]/u,match[6]/u];var p={type:'horizontal',parent:d,fileNumber:parseInt(match[1]),file:h[match[1]],line:parseInt(match[2]),left:n[0],bottom:n[1],width:o[0],height:o[1],blocks:[],elements:[],page:c.page};g.push(p);d=p;continue}match=m.match(/\)/);if(match){d.parent.blocks.push(d);d=d.parent;continue}match=m.match(/(.)([0-9]+),([0-9]+):([0-9]+),([0-9]+)(:?([0-9]+))?/);if(match){if(match[1]!='x')continue;var n=[match[4]/u,match[5]/u];if(match[7])var o=[match[7]/u,0];var q={type:match[1],parent:d,fileNumber:parseInt(match[2]),file:h[match[2]],line:parseInt(match[3]),left:n[0],bottom:n[1],height:d.height,to:((o)?o[1]:null),page:c.page};if(f[q.line]==null){f[q.line]=[]}f[q.line].push(q);d.elements.push(q);continue}}k.files=h;k.pages=j;k.blockNumberLine=f;k.hBlocks=g;k.numberPages=b;return k};return{parse:w,parseUrl:v}}]);